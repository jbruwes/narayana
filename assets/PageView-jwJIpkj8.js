import{defineComponent as e,ref as t,computed as s,watch as a,onUnmounted as r,createElementBlock as i,openBlock as o,Fragment as n,renderList as l,normalizeClass as u,createBlock as d,resolveDynamicComponent as p}from"vue";import{u as c,e as v,h as f,p as m,d as h}from"./shared-C5IlS6fE.js";import{useRoute as g,useRouter as b}from"vue-router";import{t as w,p as _,m as M,r as j,a as S,s as V,_ as x}from"./index-BHHpIaqc.js";import"./unocss-C_7A3RaX.js";import"@vuebro/loader-sfc";const E=["id","role"];const P=x(e({__name:"PageView",setup(e,{expose:i}){i();const o=t([]),n=g(),l=b(),u=s(()=>w.value?.siblings??[]),d=[],p=s(()=>u.value.filter(({enabled:e})=>e)),x=()=>{d.forEach(e=>{e()}),d.length=0},E=s(()=>void 0===w.value||w.value.parent?.flat?p.value:[w.value]),P=s(()=>new Map(E.value.map(({id:e=c()})=>[e,!1]))),$=t(new Map(P.value)),k=s(()=>{const[[e,t]=[]]=_;return _.clear(),e&&t&&_.set(e,t),Object.fromEntries(E.value.map(e=>[e.id,M(e)]))});a(o,e=>{x(),setTimeout(()=>{e.forEach(e=>{const{stop:t}=v(e,([{isIntersecting:e,target:{id:t}={}}={}]=[])=>{$.value=new Map(P.value),t&&void 0!==e&&P.value.set(t,e)},{threshold:.1});d.push(t)})})},{deep:!0}),f(window,{behavior:"smooth",onStop:()=>{if(!S.value){const{scrollX:e,scrollY:t}=window,[s]=E.value,[a]=m.value;if(a&&s){const{$children:[{id:r}={}]=[]}=a,i=Math.floor(e)||Math.floor(t)||s.id!==r?[...P.value.entries()].find(([,e])=>e)?.[0]??[...$.value.entries()].find(([,e])=>e)?.[0]??s.id:a.id;i!==n.name&&(V.value=!1,l.push({name:i}).catch(h))}}}}),r(x);const y={refs:o,route:n,router:l,siblings:u,stops:d,$siblings:p,clearStops:x,these:E,intersecting:P,$intersecting:$,templates:k,get uid(){return c},get resolve(){return j},get that(){return w}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),[["render",function(e,t,s,a,r,c){return o(!0),i(n,null,l(a.these,e=>(o(),i("div",{id:e.id??a.uid(),key:e.id??a.uid(),ref_for:!0,ref:"refs",class:u(e.class),role:e.id===a.that?.id?"main":"section","un-cloak":""},[(o(),d(p(a.templates[e.id]),{pageid:e.id,onVnodeMounted:t=>a.resolve(e)},null,8,["pageid","onVnodeMounted"]))],10,E))),128)}],["__file","PageView.vue"]]);export{P as default};
